{{<layouts/account-your-details}}
    {{$h1}}Your details{{/h1}}

    {{$column-1}}
        <ul class="page-nav" id="top">
            <li><a href="./">Update your details</a></li>
            <li><a href="apply-local-residents-discount">Apply for a local resident's discount</a></li>
            <li><a href="change-vehicle-details">Change your vehicle details</a></li>
            <li><a href="change-payment-details">Change your payment details</a></li>
            <li><a href="change-sign-in-password-pin">Change your sign-in email address, password and PIN</a></li>
            <li><a href="change-close-account">Change account type or close your account</a></li>
        </ul>
    {{/column-1}}

    {{$column-2}}
        <h2 class="heading-24" id="section1">Change your payment details</h2>
        <h3 class="heading-24">Top-up method: manual</h3>
        <p>You must remember to add funds to your account yourself when your balance is low.
        <p class="panel-indent">When your account goes below Â£10 email notification will be sent to remind you to topup. If account balance goes below zero, you will have 24 hours to add funds after that account will be closed and you may receive a penalty charge if you use the crossing and don't pay.</p>
        <a href="change-payment-details-auto" class="button" id="next" type="submit">Pay automatically</a>
    {{/column-2}}

    {{$js-functions}}
        showAddresses = function() {
            setDisplay(el.address, true);
            var addressValues = el.addressFound[el.addressFound.selectedIndex].text.split(',');
            el.addressOne.value = addressValues[0];
            el.townCity.value = addressValues[1];
            setDisplay(el.addressDetail, true);
        },
        showAddressForm = function(target) {
            if (target.checked == true) {
                setDisplay(el.addressDetail, true);
            } else {
                setDisplay(el.addressDetail, false);
            }
        },
        setAddress = function(target) {
            var addressValues = target[target.selectedIndex].text.split(',');
            el.addressOne.value = addressValues[0];
            el.townCity.value = addressValues[1];
        },
        testCompany = function(target) {
            if (target.checked == true) {
                setDisplay(el.company, true);
            } else {
                setDisplay(el.company, false);
                el.companyNumber.value = '';
            }
        },
        testLocal = function(target) {
            if (el.discountInvite) {
                var postcode = target.value.toUpperCase();
                if (postcode.match(/^(BR8|CM13|DA(1[01347]*|[23459])|RM(1[456789]|20)|SS1[67])\s*\d[A-Z]{2}$/)) {
                    setDisplay(el.discountInvite, true);
                } else {
                    setDisplay(el.discountInvite, false);
                }
            }
        }
    {{/js-functions}}

    {{$js-initialisation}}
        init = function() {
            if (window.location.search.match(/=debug/)) {
                el.body.classList.add('debug');
            }
            el.addressFound.addEventListener('change',function(e) {
                setAddress(e.target);
            });
            el.addressNotFound.addEventListener('click', function(e) {
                showAddressForm(e.target);
            }, false);
            el.behalfCompany.addEventListener('change', function(e) {
                testCompany(e.target);
            }, false);
            el.buttonNext.addEventListener('click', function(e) {
                e.preventDefault();
                if (el.localDiscount.checked) {
                    window.location = './personal/account-setup-LRDS';
                } else {
                    window.location = './personal/account-setup';
                }
            });
            el.findAddress.addEventListener('click', function(e) {
                e.preventDefault();
                showAddresses();
                setDisabled(el.buttonNext, true);
                testLocal(el.postcode);
            }, false);
            el.findCompany.addEventListener('click', function(e) {
                e.preventDefault();
            }, false);
        }
    {{/js-initialisation}}

    {{$js-objects}}
        el = {
            address: $('#address'),
            addressOne: $('#address-1'),
            addressTwo: $('#address-2'),
            addressDetail: $('#address-detail'),
            addressFound: $('#address-found'),
            addressNotFound: $('#address-not-found'),
            body: $('body'),
            buttonNext: $('#next'),
            behalfCompany: $('#behalf-of-company'),
            company: $('#company'),
            companyNumber: $('#company-number'),
            discountInvite: $('#discount-invite'),
            findAddress: $('#find-address'),
            findCompany: $('#find-company'),
            localDiscount: $('#local-discount'),
            postcode: $('#postcode'),
            townCity: $('#town-city')
        }
    {{/js-objects}}

{{/layouts/account-your-details}}
